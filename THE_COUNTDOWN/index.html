<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7N58SZ0J6W"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-7N58SZ0J6W', { 'anonymize_ip': true });
</script>
  
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Countdown.</title>
<style>
    @font-face {
      font-family: 'Manaspace';
      src: url('fonts/manaspace.ttf') format('truetype');
    }
    
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: black;
      color: #00ffdd;
      font-family: 'Manaspace', monospace;
    }

    #timer {
      font-size: 12vw;      
      letter-spacing: 1vw;  
      white-space: nowrap;   
    }

    .digit, .sep { display:inline-block; width:auto; text-align:center; }

    #forumLink {
      margin-top: 40px;
      font-size: 32px;
      color: #00ffdd;
      text-decoration: underline;
      cursor: pointer;
      display: none;
    }

    #muteBtn {
      position: fixed;
      top: 20px;
      right: 20px;
      font-size: 20px;
      padding: 8px 16px;
      cursor: pointer;
      color: black;
      background: #00ffdd;
      border: none;
      border-radius: 5px;
      font-family: 'manaspace', monospace;
      z-index: 10;
    }
</style>
</head>
<body>
<audio id="tickSound" src="sound/tick.wav" preload="auto" muted></audio>

<div id="timer">
  <span class="digit">0</span><span class="digit">0</span><span class="sep">:</span>
  <span class="digit">0</span><span class="digit">0</span><span class="sep">:</span>
  <span class="digit">0</span><span class="digit">0</span>
</div>

<button id="muteBtn">Unmute</button>

<a id="forumLink" href="https://forms.gle/TkxFKuawvrdLNRzp8" target="_blank">
  Open
</a>

<script>
const timerEl = document.getElementById('timer');
const forumLink = document.getElementById('forumLink');
const tickSound = document.getElementById('tickSound');
const muteBtn = document.getElementById('muteBtn');

let isMuted = true;
const targetTime = new Date('2025-10-06T18:00:00Z').getTime();
let lastSecond = null;

muteBtn.addEventListener('click', () => {
  isMuted = !isMuted;
  tickSound.muted = isMuted;
  muteBtn.textContent = isMuted ? 'Unmute' : 'Mute';
});

// Short flash for hour digits
function flashHourDigit(hourStr) {
  if(Math.random() < 0.75){
    const flashIndex = Math.floor(Math.random() * 3);
    const digits = timerEl.querySelectorAll(".digit");
    if(!digits[flashIndex]) return;
    const original = digits[flashIndex].textContent;
    digits[flashIndex].textContent = hourStr[flashIndex];
    setTimeout(() => {
      digits[flashIndex].textContent = '?';
    }, 50); // flash duration
  }
}

// Update timer every second for minutes/seconds
function updateTimer() {
  const now = Date.now();
  let diff = Math.max(0, targetTime - now);

  const totalHours = Math.floor(diff / (1000*60*60));
  diff %= (1000*60*60);
  const minutes = String(Math.floor(diff / (1000*60))).padStart(2,'0');
  diff %= (1000*60);
  const seconds = String(Math.floor(diff / 1000)).padStart(2,'0');

  // Play tick sound on second change
  if(seconds !== lastSecond){
    if(!isMuted){
      tickSound.currentTime = 0;
      tickSound.play().catch(e=>console.log("Audio blocked:", e));
    }
    lastSecond = seconds;

    // Flash hour digit if >= 100
    if(totalHours >= 100){
      const hourStr = String(totalHours).padStart(3,'0');
      flashHourDigit(hourStr);
    }
  }

  // Build hours display
  let hourDisplay = totalHours >= 100 ? ['?', '?', '?'] : String(totalHours).padStart(2,'0').split('');
  let timerHTML =
    hourDisplay.map(d => `<span class="digit">${d}</span>`).join('') +
    '<span class="sep">:</span>' +
    minutes.split('').map(d => `<span class="digit">${d}</span>`).join('') +
    '<span class="sep">:</span>' +
    seconds.split('').map(d => `<span class="digit">${d}</span>`).join('');
  
  timerEl.innerHTML = timerHTML;

  if(now >= targetTime){
    forumLink.style.display = 'block';
  }
}

// Continuous jitter for the 3-hour digits using requestAnimationFrame
function jitterLoop(){
  const digits = timerEl.querySelectorAll(".digit");
  for(let i=0; i<3 && digits[i]; i++){
    const x = (Math.random() - 0.5) * 6;
    const y = (Math.random() - 0.5) * 6;
    digits[i].style.transform = `translate(${x}px, ${y}px)`;
  }
  requestAnimationFrame(jitterLoop);
}

updateTimer();
setInterval(updateTimer, 1000);
requestAnimationFrame(jitterLoop);
</script>
</body>
</html>
